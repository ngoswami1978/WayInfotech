UP_SRO_FL_FLIGHT_LEG_SSR_INVENTORY
UP_SRO_FL_FLIGHT_SSR_INVENTORY



CREATE PROCEDURE [dbo].[UP_SRO_FL_FLIGHT_SSR_INVENTORY] 
@ACTION 	CHAR(1),
@FL_DATE 	INT = NULL,
@FL_NO 		CHAR(7) = NULL,
@FL_FROM 	CHAR(3) = NULL,
@FL_TO 		CHAR(3) = NULL,
@CA_CODE 	TINYINT = NULL,
@EL_SUB_CODE 	CHAR(4) = NULL,
@FL_SSR_QTY_DEFINED 	SMALLINT = NULL,
@FL_SSR_QTY_AVAILABLE 	SMALLINT  = NULL,
@RETURNID BIGINT=0 OUTPUT
AS
BEGIN
		--INSERT SECTION -- START
		IF (@ACTION='I')
		BEGIN
		if not exists (
							SELECT 1 FROM T_FL_FLIGHT_SSR_INVENTORY 
							WHERE FL_DATE=@FL_DATE
							AND FL_NO =@FL_NO
							AND FL_FROM =@FL_FROM
							AND FL_TO=@FL_TO
							AND CA_CODE=@CA_CODE
							AND EL_SUB_CODE=@EL_SUB_CODE
						)
						begin
							INSERT INTO T_FL_FLIGHT_SSR_INVENTORY (FL_DATE,FL_NO,FL_FROM,FL_TO,CA_CODE,EL_SUB_CODE,FL_SSR_QTY_DEFINED,FL_SSR_QTY_AVAILABLE)
							VALUES(@FL_DATE,@FL_NO,@FL_FROM,@FL_TO,@CA_CODE,@EL_SUB_CODE,@FL_SSR_QTY_DEFINED,@FL_SSR_QTY_AVAILABLE)
							SELECT @RETURNID=1
							RETURN @RETURNID
					   end
			else
					  begin
							SELECT @RETURNID=-100
							RETURN @RETURNID
					  end
		END
		--INSERT SECTION -- END

		--UPDATE SECTION -- START
		IF (@ACTION='U')
		BEGIN
			UPDATE T_FL_FLIGHT_SSR_INVENTORY 
			SET FL_SSR_QTY_DEFINED=@FL_SSR_QTY_DEFINED,
			FL_SSR_QTY_AVAILABLE =@FL_SSR_QTY_AVAILABLE 
			 WHERE			FL_DATE=@FL_DATE
							AND FL_NO =@FL_NO
							AND FL_FROM =@FL_FROM
							AND FL_TO=@FL_TO
							AND CA_CODE=@CA_CODE
							AND EL_SUB_CODE=@EL_SUB_CODE

			
			SELECT @RETURNID=@@ROWCOUNT
			RETURN @RETURNID
			
		END
		
		--UPDATE SECTION -- END

		--DELETE SECTION -- START
		IF (@ACTION='D')
		BEGIN
			DELETE T_FL_FLIGHT_SSR_INVENTORY  
				WHERE FL_DATE=@FL_DATE
							AND FL_NO =@FL_NO
							AND FL_FROM =@FL_FROM
							AND FL_TO=@FL_TO
							AND CA_CODE=@CA_CODE
							AND EL_SUB_CODE=@EL_SUB_CODE
			SELECT @RETURNID=@@ROWCOUNT
			RETURN @RETURNID
		END
		--DELETE SECTION -- END

		--SEARCH SECTION -- START
		IF (@ACTION='S')
		BEGIN
			
			SELECT * FROM T_FL_FLIGHT_SSR_INVENTORY
			WHERE FL_DATE=@FL_DATE
							AND FL_NO =@FL_NO
							AND FL_FROM =@FL_FROM
							AND FL_TO=@FL_TO
							AND CA_CODE=@CA_CODE
				
			SELECT @RETURNID=@@ROWCOUNT
			RETURN @RETURNID
		END
		--SEARCH SECTION -- END
END 		




go

/****** Object:  StoredProcedure [dbo].[UP_SRO_FL_FLIGHT_LEG_SSR_INVENTORY]    Script Date: 12/19/2009 12:06:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--CREATED BY RAKESH 19DEC09


ALTER PROCEDURE [dbo].[UP_SRO_FL_FLIGHT_LEG_SSR_INVENTORY] 
@ACTION 	CHAR(1),
@FL_DATE 	INT = NULL,
@FL_NO 		CHAR(7) = NULL,
@FL_LEG_FROM 	CHAR(3) = NULL,
@FL_LEG_TO 		CHAR(3) = NULL,
@CA_CODE 	TINYINT = NULL,
@EL_SUB_CODE 	CHAR(4) = NULL,
@FL_LEG_SSR_QTY_DEFINED 	SMALLINT = NULL,
@FL_LEG_SSR_QTY_AVAILABLE 	SMALLINT  = NULL,
@RETURNID BIGINT=0 OUTPUT
AS
BEGIN
		--INSERT SECTION -- START
		IF (@ACTION='I')
		BEGIN
		if not exists (
							SELECT 1 FROM T_FL_FLIGHT_LEG_SSR_INVENTORY 
							WHERE FL_DATE=@FL_DATE
							AND FL_NO =@FL_NO
							AND FL_LEG_FROM =@FL_LEG_FROM
							AND FL_LEG_TO=@FL_LEG_TO
							AND CA_CODE=@CA_CODE
							AND EL_SUB_CODE=@EL_SUB_CODE
						)
						begin
							INSERT INTO T_FL_FLIGHT_LEG_SSR_INVENTORY (FL_DATE,FL_NO,FL_LEG_FROM,FL_LEG_TO,CA_CODE,EL_SUB_CODE,FL_LEG_SSR_QTY_DEFINED,FL_LEG_SSR_QTY_AVAILABLE)
							VALUES(@FL_DATE,@FL_NO,@FL_LEG_FROM,@FL_LEG_TO,@CA_CODE,@EL_SUB_CODE,@FL_LEG_SSR_QTY_DEFINED,@FL_LEG_SSR_QTY_AVAILABLE)
							SELECT @RETURNID=1
							RETURN @RETURNID
					   end
			else
					  begin
							SELECT @RETURNID=-100
							RETURN @RETURNID
					  end
		END
		--INSERT SECTION -- END

		--UPDATE SECTION -- START
		IF (@ACTION='U')
		BEGIN
			UPDATE T_FL_FLIGHT_LEG_SSR_INVENTORY 
			SET FL_LEG_SSR_QTY_DEFINED=@FL_LEG_SSR_QTY_DEFINED,
			FL_LEG_SSR_QTY_AVAILABLE =@FL_LEG_SSR_QTY_AVAILABLE 
			 WHERE			FL_DATE=@FL_DATE
							AND FL_NO =@FL_NO
							AND FL_LEG_FROM =@FL_LEG_FROM
							AND FL_LEG_TO=@FL_LEG_TO
							AND CA_CODE=@CA_CODE
							AND EL_SUB_CODE=@EL_SUB_CODE

			
			SELECT @RETURNID=@@ROWCOUNT
			RETURN @RETURNID
			
		END
		
		--UPDATE SECTION -- END

		--DELETE SECTION -- START
		IF (@ACTION='D')
		BEGIN
			DELETE T_FL_FLIGHT_LEG_SSR_INVENTORY  
				WHERE FL_DATE=@FL_DATE
							AND FL_NO =@FL_NO
							AND FL_LEG_FROM =@FL_LEG_FROM
							AND FL_LEG_TO=@FL_LEG_TO
							AND CA_CODE=@CA_CODE
							AND EL_SUB_CODE=@EL_SUB_CODE
			SELECT @RETURNID=@@ROWCOUNT
			RETURN @RETURNID
		END
		--DELETE SECTION -- END

		--SEARCH SECTION -- START
		IF (@ACTION='S')
		BEGIN
			
			SELECT * FROM T_FL_FLIGHT_LEG_SSR_INVENTORY
			WHERE FL_DATE=@FL_DATE
							AND FL_NO =@FL_NO
							AND FL_LEG_FROM =@FL_LEG_FROM
							AND FL_LEG_TO=@FL_LEG_TO
							AND CA_CODE=@CA_CODE
				
			SELECT @RETURNID=@@ROWCOUNT
			RETURN @RETURNID
		END
		--SEARCH SECTION -- END
END 		











.Parameters.Add(New SqlParameter("@ACTION", SqlDbType.Char, 1))
                    .Parameters.Add(New SqlParameter("@FL_DATE", SqlDbType.Int))
                    .Parameters.Add(New SqlParameter("@FL_NO", SqlDbType.Char, 7))
                    .Parameters.Add(New SqlParameter("@FL_FROM", SqlDbType.Char, 3))
                    .Parameters.Add(New SqlParameter("@FL_TO", SqlDbType.Char, 3))
                    .Parameters.Add(New SqlParameter("@CA_CODE", SqlDbType.Int))
                    .Parameters.Add(New SqlParameter("@EL_SUB_CODE", SqlDbType.Char, 4))

                    .Parameters.Add(New SqlParameter("@FL_SSR_QTY_DEFINED", SqlDbType.SmallInt))
                    .Parameters.Add(New SqlParameter("@FL_SSR_QTY_AVAILABLE", SqlDbType.SmallInt))